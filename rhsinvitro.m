%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%Begin rhsinvitro.m%Function file containing the right hand sides of the ODE model%As described in%2019 Scientific Reports %Experimentally-driven mathematical modeling to improve combination %targeted and cytotoxic therapy for HER2+ breast cancer%in the subsection "Mathematical models" in the "Methods" of the%manuscript.%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%This file is called either to simulate the model directly or for%calibration of parameters.%The function receives a time vector from an ODE solver, the x vector%containing the variables of the model, p is a vector passed from a%optimization function for parameter calibration, af and pf give%information about the free drugs when the tumor cells are dosed, free is a%vector telling the function which parameters may be being calibrated, and%params is the parameter values being passed into the function for the%model.%The function returns the time vector and the corresponding values for all%three variables of the model.%Angela M. Jarrett (ajarret@utexas.edu)%The University of Texas at Austin% https://cco.oden.utexas.edu/%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~function [F] = rhsinvitro(t,x,p,af,pf,free,params)    %Variables    T  = x(1); %Tumor cells    Ab = x(2); %Bound trastuzumab antibodies    Pi = x(3); %Internalized paclitaxel molecules    %Assigning the parameters passed into the function    %Note the S parameters are synergy parameters that can be explored with    %multiple drug doses, S1 is the synergy parameter presented in detail     %in the paper cited above.    k     = params(1);    S1    = params(2);    nA    = params(3);    dP    = params(4);    theta = params(5);    S2    = params(6);    bA    = params(7);    S3    = params(8);    aP    = params(9);    gP    = params(10);    tP    = params(11);    tA    = params(12);    S4    = params(13);    S5    = params(14);    S6    = params(15);        for w = 1:size(free,2)    %Setting our "free" control variable from the parameter calibration     if(free(w)==1)      k     = p(w);    elseif(free(w)==2)  S1    = p(w);    elseif(free(w)==3)  nA    = p(w);    elseif(free(w)==4)  dP    = p(w);    elseif(free(w)==5)  theta = p(w);    elseif(free(w)==6)  S2    = p(w);    elseif(free(w)==7)  bA    = p(w);    elseif(free(w)==8)  S3    = p(w);    elseif(free(w)==9)  aP    = p(w);    elseif(free(w)==10) gP    = p(w);    elseif(free(w)==11) tP    = p(w);    elseif(free(w)==12) tA    = p(w);    elseif(free(w)==13) S4    = p(w);    elseif(free(w)==14) S5    = p(w);    elseif(free(w)==15) S6    = p(w);    end         end        %Define values for cell size to approximate number of cells as well as    %the expression level of HER2 for the cell line    ExpressionPerCell = 1.94*10^6;   %HER2 per BT474 cell    cellradius = 0.00125;            %BT474 cell    areapercell = pi*(cellradius^2); %cm^2    areaofdish = 0.32;               %cm^2    CellNumConvert = areaofdish/areapercell;        %Dose off switch after the drug has been on the cells for 24 hours    A = af(1);    P = pf(1);    if t > af(2)+1        A = 0;    end    if t > pf(2)+1        P = 0;    end    if t < af(2)        A = 0;    end    if t < pf(2)        P = 0;    end        %First we define the functions of trastuzumab and paclitaxel that    %modulate the tumor cells' growth    Abadjust = 1-(t>=(S5*tA+af(2)-1))*S3*nA*100*Ab/ExpressionPerCell;    Piadjust = (theta-S4*dP*(exp(-S2*gP*(t-(S6*tP+pf(2)-1)))+1*S1)*Pi)*CellNumConvert;    %If the internalized paclitaxel drives the equation to have a negative    %carrying capacity, we simply set this to 1 as a numerical correction    if Piadjust<0        Piadjust = 1;    end    %Here we also numerically insure that there is not positive growth due    %to both drugs causing negative effects on the tumor growth    if (Abadjust)<0 && (1-T/(Piadjust))<0             %Tumor cell equation        F = [  g0*abs(Abadjust)*(1-T/(Piadjust))*T;...              %Bound trastuzumab equation               bA*10^(-19)*(A-Ab)*(T*ExpressionPerCell-Ab)*(t<af(2)+1);              %Internalized paclitaxel equation               (aP*(P-Pi)*T/(1*CellNumConvert))*(t<pf(2)+1);];     else        F = [g0*(Abadjust)*(1-T/(Piadjust))*T;...             bA*10^(-19)*(A-Ab)*(T*ExpressionPerCell-Ab)*(t<af(2)+1);             (aP*(P-Pi)*T/(1*CellNumConvert))*(t<pf(2)+1);];    endend%~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~%end of file